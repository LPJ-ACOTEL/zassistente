sap.ui.define(["sap/ui/core/mvc/Controller"], function(Controller) {
	"use strict";
	return Controller.extend("com.assistente.controller.Inicio", {

		onAfterRendering: function() {

			var filters = [];
			var filter = "";
			filter = new sap.ui.model.Filter("cod_dist", sap.ui.model.FilterOperator.EQ, "");
			filters.push(filter);

			var list = sap.ui.getCore().byId("idComboLojaFragment");
			var binding = list.getBinding("items");
			binding.oModel.setSizeLimit(10000);

			binding.filter(filters);
			var oModel = this.getView().getModel();
			var thisview = this;

			this.getView().byId("nomeLoja").setVisible(true);

			oModel.read("/atualiza_lojaSet", {
				filters: filters,
				success: function(success, response, odata) {

					sap.ui.getCore().setModel(success.results[0].usuario, "usuario_loja");
					sap.ui.getCore().setModel(success.results[0].nomeUsuario, "usuarionome_loja");

					var nameUser = success.results[0].nomeUsuario;
					var user = success.results[0].usuario;
					thisview.byId("idUsuario").setText(user);
					thisview.byId("nomeUsuario").setText(nameUser);

					//var sLoja = sap.ui.getCore().getModel("nomeLoja");
					//let nomeLoja = thisview.byId("nomeLoja");
					//if (typeof sLoja != undefined) {
					//  nomeLoja.setText(sLoja);
					//}	  

				},
				error: function(oError, response) {
					thisView.getView().setBusy(false);
					MessageToast.show(hdrMessage);
					valueHelpDialog1.destroy();
				}
			})

		},

		onInit: function() {

			//Mime Model
			var oRootPath = jQuery.sap.getModulePath("com.assistente");
			var oImageModel = new sap.ui.model.json.JSONModel({
				path: oRootPath
			});
			this.getView().setModel(oImageModel, "imageModel");

		},

		onPressMenuButton: function() {
			let menu = sap.ui.getCore().byId("application-ZASS-display-component---App--idAppControl-Master");
			//container-com.assistente---App--idAppControl-Master");
			//application-ZASS-display-component---administracotacao--idAppControl	
			if (menu.hasStyleClass("menuFechado")) {
				menu.setWidth("300px");
				menu.removeStyleClass("menuFechado");
				menu.addStyleClass("menuAberto");
			} else {
				menu.setWidth("0");
				menu.removeStyleClass("menuAberto");
				menu.addStyleClass("menuFechado")
			}
		},

		_openNav: function() {
			let menu = sap.ui.getCore().byId("__component0---app--idAppControl-Master");
			menu.setWidth("170px");
			menu.removeStyleClass("menuFechado");
			menu.addStyleClass("menuAberto");
		},

		onChangeloja: function(Evt) {
			var oModel = this.getView().getModel();
			oModel.update("/atualiza_lojaSet(cod_dist='" + Evt.mParameters.selectedItem.mProperties.key + "')", oData, {
				success: function(success, response, odata) {
					thisView.getView().setBusy(false);
					var hdrMessage = response.headers["sap-message"];
					var hdrMessageObject = JSON.parse(hdrMessage);
					MessageToast.show(hdrMessageObject.message);
				},
				error: function(oError, response) {
					thisView.getView().setBusy(false);
					var hdrMessage = $(oError.responseText).find("message").first().text();
					MessageToast.show(hdrMessage);
				}
			})
			this.CentroLoja = new sap.ui.model.json.JSONModel();
			var loja = [];
			loja.push({
				loja: Evt.mParameters.selectedItem.mProperties.key
			})
			this.CentroLoja.setData(loja);
			sap.ui.getCore().setModel(this.CentroLoja, "centroloja");
		},

		_navToUnauthorized: function() {
			this.getRouter().getTargets().display("notFound");
		},

		_navBack: function() {
			//This code was generated by the layout editor.
			var oHistory = sap.ui.core.routing.History.getInstance(),
				sPreviousHash = oHistory.getPreviousHash();

			this.getView().unbindObject();
			if (sPreviousHash !== undefined) {
				history.go(-1);
			} else {
				this.getRouter().getTargets().display("master");
			}
		}
	});
});